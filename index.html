<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#3498db">
    <meta name="description" content="–ò–Ω—Ç–µ—Ä–Ω–µ—Ç-—Ä–∞–¥–∏–æ –ø–ª–µ–µ—Ä —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ñ–æ–Ω–æ–≤–æ–≥–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è">
    <title>–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –†–∞–¥–∏–æ PWA</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìª</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìª</text></svg>">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
            position: relative;
        }

        .pwa-badge {
            position: absolute;
            top: 0;
            right: 0;
            background: #3498db;
            color: white;
            font-size: 0.7rem;
            padding: 3px 8px;
            border-radius: 10px;
        }

        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .description {
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        .install-btn {
            background: #2ecc71;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .install-btn:hover {
            background: #27ae60;
        }

        .player-section {
            margin-bottom: 30px;
            text-align: center;
        }

        .now-playing {
            background: rgba(236, 240, 241, 0.8);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .station-name {
            font-weight: bold;
            color: #3498db;
            margin-bottom: 8px;
            font-size: 1.2rem;
        }

        .track-info {
            font-size: 1.1rem;
            font-weight: 500;
            color: #2c3e50;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        button {
            background: #3498db;
            border: none;
            padding: 14px 25px;
            border-radius: 50px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 160px;
            justify-content: center;
        }

        button:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .button-icon {
            width: 22px;
            height: 22px;
            flex-shrink: 0;
        }

        .add-station {
            margin: 25px 0;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
        }

        input {
            flex: 1;
            min-width: 250px;
            padding: 14px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 50px;
            background: white;
            color: #333;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s;
        }

        input:focus {
            border-color: #3498db;
        }

        input::placeholder {
            color: #95a5a6;
        }

        .stations-list {
            margin-top: 25px;
        }

        .stations-list h2 {
            margin-bottom: 15px;
            text-align: center;
            color: #3498db;
        }

        .station-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(236, 240, 241, 0.6);
            padding: 16px;
            margin: 12px 0;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .station-item:hover {
            background: rgba(236, 240, 241, 0.9);
        }

        .station-info {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-right: 15px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .station-name-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            min-width: 0;
        }

        .station-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            min-width: auto;
            padding: 10px 16px;
        }

        .play-btn {
            background: #2ecc71;
        }

        .play-btn:hover {
            background: #27ae60;
        }

        .edit-btn {
            background: #f39c12;
        }

        .edit-btn:hover {
            background: #d35400;
        }

        .delete-btn {
            background: #e74c3c;
        }

        .delete-btn:hover {
            background: #c0392b;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }

        #volume {
            width: 100px;
        }

        .notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #2c3e50;
            color: white;
            padding: 12px 20px;
            border-radius: 50px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .notification.show {
            opacity: 1;
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 1.8rem;
            }
            
            .controls {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
            
            .add-station {
                flex-direction: column;
            }
            
            input {
                width: 100%;
            }
            
            .station-item {
                flex-direction: column;
                gap: 12px;
                text-align: center;
            }
            
            .station-info {
                margin-right: 0;
                margin-bottom: 10px;
                flex-direction: column;
            }
            
            .station-actions {
                width: 100%;
                justify-content: center;
            }

            .pwa-badge {
                position: static;
                margin-bottom: 10px;
            }
        }

        footer {
            text-align: center;
            margin-top: 30px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="pwa-badge">PWA</div>
            <h1>üìª –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –†–∞–¥–∏–æ PWA</h1>
            <p class="description">–°–ª—É—à–∞–π—Ç–µ –≤–∞—à–∏ –ª—é–±–∏–º—ã–µ —Ä–∞–¥–∏–æ—Å—Ç–∞–Ω—Ü–∏–∏ –¥–∞–∂–µ –∫–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–≤—ë—Ä–Ω—É—Ç–æ</p>
            <button id="installButton" class="install-btn" style="display: none;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="white">
                    <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                </svg>
                –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            </button>
        </header>
        
        <div class="player-section">
            <div class="now-playing">
                <div class="station-name" id="stationName">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</div>
                <div class="track-info" id="trackInfo">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–¥–∏–æ—Å—Ç–∞–Ω—Ü–∏—é –¥–ª—è –Ω–∞—á–∞–ª–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è</div>
            </div>
            
            <div class="controls">
                <button id="playBtn" onclick="togglePlay()">
                    <svg class="button-icon" viewBox="0 0 24 24" fill="white">
                        <path d="M8 5v14l11-7z"/>
                    </svg>
                    –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏
                </button>
                <button id="stopBtn" onclick="stopPlay()" disabled>
                    <svg class="button-icon" viewBox="0 0 24 24" fill="white">
                        <path d="M6 6h12v12H6z"/>
                    </svg>
                    –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                </button>
            </div>

            <div class="volume-control">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="#7f8c8d">
                    <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
                </svg>
                <input type="range" id="volume" min="0" max="1" step="0.1" value="0.7" oninput="setVolume(this.value)">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="#7f8c8d">
                    <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
                </svg>
            </div>
        </div>

        <div class="add-station">
            <input type="text" id="stationUrl" placeholder="–í–≤–µ–¥–∏—Ç–µ URL —Ä–∞–¥–∏–æ—Å—Ç–∞–Ω—Ü–∏–∏">
            <button onclick="addStation()">
                <svg class="button-icon" viewBox="0 0 24 24" fill="white">
                    <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                </svg>
                –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞–Ω—Ü–∏—é
            </button>
        </div>

        <div class="stations-list">
            <h2>–°–ø–∏—Å–æ–∫ —Ä–∞–¥–∏–æ—Å—Ç–∞–Ω—Ü–∏–π</h2>
            <div id="stationsList">
                <!-- –°–ø–∏—Å–æ–∫ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω JavaScript -->
            </div>
        </div>

        <footer>
            <p>–ò–Ω—Ç–µ—Ä–Ω–µ—Ç-—Ä–∞–¥–∏–æ –ø–ª–µ–µ—Ä PWA ¬© 2023 | –í—Å–µ —Å—Ç–∞–Ω—Ü–∏–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç –∏—Ö –ø—Ä–∞–≤–æ–æ–±–ª–∞–¥–∞—Ç–µ–ª—è–º</p>
        </footer>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—É–¥–∏–æ
        let audio = null;
        let currentStation = null;
        let stations = JSON.parse(localStorage.getItem('radioStations')) || [];
        let deferredPrompt = null;
        
        // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∏–º–µ—Ä —Å—Ç–∞–Ω—Ü–∏–∏, –µ—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç
        if (stations.length === 0) {
            stations.push({
                url: 'https://pianosolo.streamguys1.com/live',
                name: 'Piano Solo Radio'
            });
            saveStations();
        }

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker –¥–ª—è PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').then(registration => {
                    console.log('SW registered: ', registration);
                }).catch(registrationError => {
                    console.log('SW registration failed: ', registrationError);
                });
            });
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PWA
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            const installButton = document.getElementById('installButton');
            if (installButton) {
                installButton.style.display = 'inline-flex';
                installButton.addEventListener('click', () => {
                    installButton.style.display = 'none';
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('User accepted the install prompt');
                        }
                        deferredPrompt = null;
                    });
                });
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        function initPage() {
            renderStationsList();
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –∏–≥—Ä–∞—é—â—É—é —Å—Ç–∞–Ω—Ü–∏—é –µ—Å–ª–∏ –µ—Å—Ç—å
            const lastStationIndex = localStorage.getItem('lastStationIndex');
            if (lastStationIndex !== null && stations[lastStationIndex]) {
                playStation(parseInt(lastStationIndex));
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Media Session API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π/–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
            if ('mediaSession' in navigator) {
                initMediaSession();
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Media Session API
        function initMediaSession() {
            navigator.mediaSession.setActionHandler('play', function() {
                if (audio && audio.paused) {
                    togglePlay();
                } else if (!audio && stations.length > 0) {
                    playStation(0);
                }
            });

            navigator.mediaSession.setActionHandler('pause', function() {
                if (audio && !audio.paused) {
                    togglePlay();
                }
            });

            navigator.mediaSession.setActionHandler('stop', function() {
                stopPlay();
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –¥–ª—è Media Session
        function updateMediaMetadata(stationName) {
            if ('mediaSession' in navigator) {
                navigator.mediaSession.metadata = new MediaMetadata({
                    title: stationName,
                    artist: '–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –†–∞–¥–∏–æ',
                    artwork: [
                        { src: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="512" height="512" viewBox="0 0 512 512"><rect width="512" height="512" fill="%233498db"/><text x="256" y="256" dominant-baseline="middle" text-anchor="middle" font-size="200" fill="white">üìª</text></svg>', sizes: '512x512', type: 'image/svg' }
                    ]
                });
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞–Ω—Ü–∏–π –≤ localStorage
        function saveStations() {
            localStorage.setItem('radioStations', JSON.stringify(stations));
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å—Ç–∞–Ω—Ü–∏–π
        function renderStationsList() {
            const list = document.getElementById('stationsList');
            // –û—á–∏—â–∞–µ–º —Ç–æ–ª—å–∫–æ —ç–ª–µ–º–µ–Ω—Ç—ã —Å—Ç–∞–Ω—Ü–∏–π, –æ—Å—Ç–∞–≤–ª—è—è –∑–∞–≥–æ–ª–æ–≤–æ–∫
            const items = list.querySelectorAll('.station-item');
            items.forEach(item => item.remove());
            
            stations.forEach((station, index) => {
                const stationItem = document.createElement('div');
                stationItem.className = 'station-item';
                stationItem.innerHTML = `
                    <div class="station-info">
                        <span class="station-name-text">${station.name}</span>
                        <input class="station-name-input" value="${station.name}" style="display: none;" 
                            onkeypress="handleStationNameEdit(event, ${index})" 
                            onblur="saveStationName(${index})">
                    </div>
                    <div class="station-actions">
                        <button class="action-btn play-btn" onclick="playStation(${index})">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="white">
                                <path d="M8 5v14l11-7z"/>
                            </svg>
                        </button>
                        <button class="action-btn edit-btn" onclick="toggleEditStationName(${index})">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="white">
                                <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                            </svg>
                        </button>
                        <button class="action-btn delete-btn" onclick="deleteStation(${index})">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="white">
                                <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                            </svg>
                        </button>
                    </div>
                `;
                list.appendChild(stationItem);
            });
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è —Å—Ç–∞–Ω—Ü–∏–∏
        function toggleEditStationName(index) {
            const stationItem = document.querySelectorAll('.station-item')[index];
            const nameText = stationItem.querySelector('.station-name-text');
            const nameInput = stationItem.querySelector('.station-name-input');
            
            if (nameText.style.display !== 'none') {
                nameText.style.display = 'none';
                nameInput.style.display = 'block';
                nameInput.focus();
                nameInput.select();
            } else {
                nameText.style.display = 'inline';
                nameInput.style.display = 'none';
                nameInput.value = nameText.textContent;
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Å—Ç–∞–Ω—Ü–∏–∏ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
        function saveStationName(index) {
            const stationItem = document.querySelectorAll('.station-item')[index];
            const nameText = stationItem.querySelector('.station-name-text');
            const nameInput = stationItem.querySelector('.station-name-input');
            
            if (nameInput.value.trim() !== '') {
                nameText.textContent = nameInput.value.trim();
                stations[index].name = nameInput.value.trim();
                saveStations();
                
                // –ï—Å–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–∞—è —Å—Ç–∞–Ω—Ü–∏—è —Å–µ–π—á–∞—Å –∏–≥—Ä–∞–µ—Ç, –æ–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è
                if (currentStation === index) {
                    document.getElementById('stationName').textContent = nameInput.value.trim();
                    updateMediaMetadata(nameInput.value.trim());
                }
            }
            
            nameText.style.display = 'inline';
            nameInput.style.display = 'none';
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è Enter –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –Ω–∞–∑–≤–∞–Ω–∏—è
        function handleStationNameEdit(event, index) {
            if (event.key === 'Enter') {
                saveStationName(index);
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç–∞–Ω—Ü–∏–∏
        function addStation() {
            const urlInput = document.getElementById('stationUrl');
            const url = urlInput.value.trim();
            
            if (url && isValidUrl(url)) {
                const name = extractDomainName(url);
                stations.push({ url, name });
                saveStations();
                renderStationsList();
                urlInput.value = '';
                showNotification('–°—Ç–∞–Ω—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
            } else {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π URL —Ä–∞–¥–∏–æ—Å—Ç–∞–Ω—Ü–∏–∏');
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞–Ω—Ü–∏–∏
        function deleteStation(index) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ä–∞–¥–∏–æ—Å—Ç–∞–Ω—Ü–∏—é?')) {
                stations.splice(index, 1);
                saveStations();
                renderStationsList();
                
                // –ï—Å–ª–∏ —É–¥–∞–ª—è–µ–º–∞—è —Å—Ç–∞–Ω—Ü–∏—è –±—ã–ª–∞ —Ç–µ–∫—É—â–µ–π, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
                if (currentStation === index) {
                    stopPlay();
                }
                
                showNotification('–°—Ç–∞–Ω—Ü–∏—è —É–¥–∞–ª–µ–Ω–∞');
            }
        }

        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ç–∞–Ω—Ü–∏–∏
        function playStation(index) {
            stopPlay(); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
            
            currentStation = index;
            const station = stations[index];
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω–¥–µ–∫—Å –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç–∞–Ω—Ü–∏–∏
            localStorage.setItem('lastStationIndex', index);
            
            audio = new Audio(station.url);
            audio.volume = document.getElementById('volume').value;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞—Ç—Ä–∏–±—É—Ç –¥–ª—è —Ñ–æ–Ω–æ–≤–æ–≥–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
            audio.setAttribute('playsinline', '');
            audio.setAttribute('preload', 'auto');
            
            audio.play()
                .then(() => {
                    document.getElementById('playBtn').disabled = true;
                    document.getElementById('stopBtn').disabled = false;
                    document.getElementById('stationName').textContent = station.name;
                    updateTrackInfo('–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç—Ä–µ–∫–µ...');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –º–µ–¥–∏–∞-–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
                    updateMediaMetadata(station.name);
                    
                    // –ú–µ–Ω—è–µ–º –∏–∫–æ–Ω–∫—É –Ω–∞ –ø–∞—É–∑—É
                    const playIcon = document.querySelector('#playBtn .button-icon');
                    playIcon.innerHTML = '<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>';
                    document.getElementById('playBtn').innerHTML = playIcon.outerHTML + ' –ü–∞—É–∑–∞';
                    
                    // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ç—Ä–µ–∫–∞
                    try {
                        audio.addEventListener('loadedmetadata', () => {
                            updateTrackInfo('–°—Ç–∞–Ω—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
                        });
                    } catch (e) {
                        updateTrackInfo('–°—Ç–∞–Ω—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:', error);
                    updateTrackInfo('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è');
                    showNotification('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ URL');
                });
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è/–ø–∞—É–∑—ã
        function togglePlay() {
            if (audio && !audio.paused) {
                audio.pause();
                const playIcon = document.querySelector('#playBtn .button-icon');
                playIcon.innerHTML = '<path d="M8 5v14l11-7z"/>';
                document.getElementById('playBtn').innerHTML = playIcon.outerHTML + ' –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏';
                if ('mediaSession' in navigator) {
                    navigator.mediaSession.playbackState = 'paused';
                }
            } else if (audio) {
                audio.play()
                    .then(() => {
                        const playIcon = document.querySelector('#playBtn .button-icon');
                        playIcon.innerHTML = '<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>';
                        document.getElementById('playBtn').innerHTML = playIcon.outerHTML + ' –ü–∞—É–∑–∞';
                        if ('mediaSession' in navigator) {
                            navigator.mediaSession.playbackState = 'playing';
                        }
                    })
                    .catch(error => {
                        console.error('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:', error);
                        showNotification('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è');
                    });
            } else if (stations.length > 0) {
                // –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –∏–≥—Ä–∞–µ—Ç, –Ω–æ –µ—Å—Ç—å —Å—Ç–∞–Ω—Ü–∏–∏, –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –ø–µ—Ä–≤—É—é
                playStation(0);
            }
        }

        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
        function stopPlay() {
            if (audio) {
                audio.pause();
                audio = null;
            }
            
            const playBtn = document.getElementById('playBtn');
            const stopBtn = document.getElementById('stopBtn');
            const stationNameEl = document.getElementById('stationName');
            const trackInfoEl = document.getElementById('trackInfo');
            
            if (playBtn) playBtn.disabled = false;
            if (stopBtn) stopBtn.disabled = true;
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏–∫–æ–Ω–∫—É –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
            if (playBtn) {
                const playIcon = document.querySelector('#playBtn .button-icon');
                if (playIcon) {
                    playIcon.innerHTML = '<path d="M8 5v14l11-7z"/>';
                    playBtn.innerHTML = playIcon.outerHTML + ' –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏';
                }
            }
            
            if (stationNameEl) stationNameEl.textContent = '–ù–µ –≤—ã–±—Ä–∞–Ω–æ';
            if (trackInfoEl) trackInfoEl.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–¥–∏–æ—Å—Ç–∞–Ω—Ü–∏—é –¥–ª—è –Ω–∞—á–∞–ª–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è';
            
            // –û—á–∏—â–∞–µ–º –º–µ–¥–∏–∞-–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
            if ('mediaSession' in navigator) {
                navigator.mediaSession.metadata = null;
                navigator.mediaSession.playbackState = 'none';
            }
            
            currentStation = null;
            
            // –£–¥–∞–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç–∞–Ω—Ü–∏–∏
            localStorage.removeItem('lastStationIndex');
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
        function setVolume(value) {
            if (audio) {
                audio.volume = value;
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–º —Ç—Ä–µ–∫–µ
        function updateTrackInfo(info) {
            const trackInfoEl = document.getElementById('trackInfo');
            if (trackInfoEl) {
                trackInfoEl.textContent = info;
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ URL
        function isValidUrl(url) {
            try {
                new URL(url);
                return true;
            } catch (e) {
                return false;
            }
        }

        // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –¥–æ–º–µ–Ω–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function extractDomainName(url) {
            try {
                const urlObj = new URL(url);
                return urlObj.hostname.replace('www.', '').split('.')[0];
            } catch (e) {
                return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å—Ç–∞–Ω—Ü–∏—è';
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = initPage;
    </script>

    <script>
        // Service Worker –¥–ª—è —Ñ–æ–Ω–æ–≤–æ–≥–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
        const registerServiceWorker = async () => {
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.register('sw.js', {
                        scope: './',
                    });
                    
                    if (registration.installing) {
                        console.log('Service worker installing');
                    } else if (registration.waiting) {
                        console.log('Service worker installed');
                    } else if (registration.active) {
                        console.log('Service worker active');
                    }
                } catch (error) {
                    console.error(`Registration failed with ${error}`);
                }
            }
        };

        registerServiceWorker();
    </script>
</body>
</html>